const sheetname="Sheet1";const select=["B","C","D","E","F","H","J","K","M","L","I","G"];const yomiIndex=1;const authorIndices=[0,yomiIndex];const title2Index=11;const titleIndices=[2,4,title2Index];const publisher2Index=10;const publisherIndices=[5,publisher2Index];const publishyearIndex=6;const NDLBibIDIndex=9;var querySelect=[];var hiddenIndex=-1;select.forEach(function(b,a){if(a===NDLBibIDIndex){hiddenIndex=querySelect.length}if(a!==yomiIndex&&a!==title2Index&&a!==publisher2Index){querySelect.push(b)}});const ro=new ResizeObserver(function(){setResultsSize()});new Promise(function(){setTimeout(function(){var a;do{a=document.getElementById("wrapper")}while(!a);ro.observe(a)},1000)});function setResultsSize(){var c=document.getElementById("wrapper");var a=document.getElementById("result-wrapper");var d=a.getBoundingClientRect();var b=document.getElementById("results");if(d.left===0){b.style.height=(c.getBoundingClientRect().height-d.top)+"px";b.style.width=c.getBoundingClientRect().width+"px"}else{b.style.height=c.getBoundingClientRect().height+"px";b.style.width=(c.getBoundingClientRect().width-280)+"px"}}function toKatakana(a){return a.replace(/[ぁ-ゖ]/g,function(b){return String.fromCharCode(b.charCodeAt(0)+96)})}function sendQuery(d){var g={};var a={};var e="select ";var f=false;var h;var c;["keyword","title","author","publisher"].forEach(function(i){g[i+"s"]=document.querySelector('input[name="'+i+'"]').value.replace(/[\s\u3000"]+/g," ").replace(/^\s*|\s*$/g,"").split(" ");g[i+"Operator"]=(document.querySelector('input[name="'+i+'Or"]').checked?"or":"and")});["from","until"].forEach(function(j){var k=document.querySelector('input[name="year'+j+'"]');var i=parseInt(k.value,10);if(Number.isNaN(i)){k.value=""}else{a[j]=i}});if(g.keywords[0]||g.titles[0]||g.authors[0]||g.publishers[0]||a.from||a.until){h="";querySelect.forEach(function(i){e+=h+i;if(!h){h=","}});e+=" where";if(g.keywords[0]){if(f){e+="and"}f=true;h="";e+="(";g.keywords.forEach(function(i){e+=h+"(";c="";titleIndices.forEach(function(j){e+=c+select[j]+' contains"'+i+'"';if(!c){c="or "}});authorIndices.forEach(function(j){e+=c+select[j]+' contains"'+i+'"'});publisherIndices.forEach(function(j){e+=c+select[j]+' contains"'+i+'"'});e+=")";if(!h){h=g.keywordOperator}});e+=")"}if(g.titles[0]){if(f){e+="and"}f=true;h="";e+="(";g.titles.forEach(function(i){e+=h+"(";c="";titleIndices.forEach(function(j){e+=c+select[j]+' contains"'+i+'"';if(!c){c="or "}});e+=")";if(!h){h=g.titleOperator}});e+=")"}if(g.authors[0]){if(f){e+="and"}f=true;h="";e+="(";g.authors.forEach(function(i){e+=h+"(";c="";authorIndices.forEach(function(j){if(j===yomiIndex){i=toKatakana(i)}e+=c+select[j]+' contains"'+i+'"';if(!c){c="or "}});e+=")";if(!h){h=g.authorOperator}});e+=")"}if(g.publishers[0]){if(f){e+="and"}f=true;h="";e+="(";g.publishers.forEach(function(i){e+=h+"(";c="";publisherIndices.forEach(function(j){e+=c+select[j]+' contains"'+i+'"';if(!c){c="or "}});e+=")";if(!h){h=g.publisherOperator}});e+=")"}if(a.from||a.until){if(f){e+="and"}f=true;e+="(";if(a.from){e+=select[publishyearIndex]+">="+a.from;if(a.until){e+=" and "}}if(a.until){e+=select[publishyearIndex]+"<="+a.until}e+=")"}document.activeElement.blur();setResultsSize();const b=document.createElement("script");b.src="https://docs.google.com/spreadsheets/d/1-XgySBso-vJoqMhmYgUZMtjcCY0qnjm-vIr3c6J7_M8/gviz/tq?tqx=out:json;responseHandler:callback&headers=1&sheet=%22"+sheetname+"%22&tq="+encodeURIComponent(e);document.head.appendChild(b)}else{document.getElementById("results").innerHTML=""}d.preventDefault()}function callback(b){var d=new google.visualization.DataTable(b.table);var a=new google.visualization.DataView(d);var c=new google.visualization.Table(document.getElementById("results"));a.hideColumns([hiddenIndex]);c.draw(a,{width:"100%"});google.visualization.events.addListener(c,"select",function(){var f=c.getSelection();var g;var h;var e;if(f.length>0){g=c.getSelection()[0].row;h=d.getValue(g,hiddenIndex);c.setSelection([]);if(h.match(/^[0-9]+$/)){e=document.createElement("a");e.href="https://id.ndl.go.jp/bib/"+h;e.target="_blank";e.rel="noreferrer";e.click();e.href="";e.remove()}}})};