const sheetname="Sheet1";const select=["B","C","D","E","F","H","J","K","M","L","I","G"];const indices={author:[1,0],publisher:[10,5],title:[11,2,4]};const publishyearIndex=6;const NDLBibIDIndex=9;var querySelect="select ";var hiddenIndex;(function(){var b="";var a=0;select.forEach(function(d,c){if(c===NDLBibIDIndex){hiddenIndex=a}if(Object.keys(indices).map(function(e){return indices[e][0]}).includes(c)){return}querySelect+=b+d;b=",";a+=1});querySelect+=" where"}());const ro=new ResizeObserver(function(){setResultsSize()});new Promise(function(){setTimeout(function(){var a;do{a=document.getElementById("wrapper")}while(!a);ro.observe(a)},1000)});function setResultsSize(){var c=document.getElementById("wrapper");var a=document.getElementById("result-wrapper");var d=a.getBoundingClientRect();var b=document.getElementById("results");if(d.left===0){b.style.height=(c.getBoundingClientRect().height-d.top)+"px";b.style.width=c.getBoundingClientRect().width+"px"}else{b.style.height=c.getBoundingClientRect().height+"px";b.style.width=(c.getBoundingClientRect().width-280)+"px"}}function toKatakana(a){return a.replace(/[ぁ-ゖ]/g,function(b){return String.fromCharCode(b.charCodeAt(0)+96)})}function makeQueryString(b,a){var c="(";var d="";b.forEach(function(e){indices[e].forEach(function(f){if(f===indices.author[0]){c+=d+select[f]+' contains"'+toKatakana(a)+'"'}else{c+=d+select[f]+' contains"'+a+'"'}d="or "})});c+=")";return c}function sendQuery(c){var f={};var a={};var d="";var e=querySelect;var g;["keyword"].concat(Object.keys(indices)).forEach(function(h){f[h]=document.querySelector('input[name="'+h+'"]').value.replace(/[\s\u3000"]+/g," ").replace(/^\s*|\s*$/g,"").split(" ");f[h+"Operator"]=(document.querySelector('input[name="'+h+'Or"]').checked?"or":"and")});["from","until"].forEach(function(i){var j=document.querySelector('input[name="year'+i+'"]');var h=parseInt(j.value,10);if(Number.isNaN(h)){j.value=""}else{a[i]=h}});if(f.keyword[0]){d+=e;e="and";g="";d+="(";f.keyword.forEach(function(h){d+=g;d+=makeQueryString(Object.keys(indices),h);g=f.keywordOperator});d+=")"}Object.keys(indices).forEach(function(h){if(f[h][0]){d+=e;e="and";g="";d+="(";f[h].forEach(function(i){d+=g;d+=makeQueryString([h],i);g=f[h+"Operator"]});d+=")"}});if(a.from||a.until){d+=e;e="and";d+="(";if(a.from){d+=select[publishyearIndex]+">="+a.from;if(a.until){d+=" and "}}if(a.until){d+=select[publishyearIndex]+"<="+a.until}d+=")"}if(d){document.activeElement.blur();setResultsSize();const b=document.createElement("script");b.src="https://docs.google.com/spreadsheets/d/1-XgySBso-vJoqMhmYgUZMtjcCY0qnjm-vIr3c6J7_M8/gviz/tq?tqx=out:json;responseHandler:callback&headers=1&sheet=%22"+sheetname+"%22&tq="+encodeURIComponent(d);document.head.appendChild(b)}else{document.getElementById("results").innerHTML=""}c.preventDefault()}function callback(b){var d=new google.visualization.DataTable(b.table);var a=new google.visualization.DataView(d);var c=new google.visualization.Table(document.getElementById("results"));a.hideColumns([hiddenIndex]);c.draw(a,{width:"100%"});google.visualization.events.addListener(c,"select",function(){var f=c.getSelection();var g;var h;var e;if(f.length>0){g=c.getSelection()[0].row;h=d.getValue(g,hiddenIndex);if(h.match(/^[0-9]+$/)){e=document.getElementById("dummy");e.href="https://id.ndl.go.jp/bib/"+h;e.click()}c.setSelection([])}})};